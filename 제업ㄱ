-- nil ì—ëŸ¬ ì™„ì „ í•´ê²° | FindFirstChild ì•ˆì „í™” | Lv10+ ìŠ¬ë¼ì„ ê°•ì œ | ë¨¸ë¦¬ ìœ„ ìˆ˜ì§ ì—ë“œë¦¼ | ì¿¨íƒ€ì„ 0.02ì´ˆ
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local VirtualUser = game:GetService("VirtualUser")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

local Character, HRP, Hum = nil, nil, nil
local farming = true
local lastSell = 0
local curTarget = nil
local switchTime = 0

-- ë¦¬ìŠ¤í° ë°”ì¸ë“œ
local function bindChar(char)
    print("[DEBUG] ìºë¦­í„° ì¬ë°”ì¸ë“œ")
    Character = char
    HRP = char:WaitForChild("HumanoidRootPart", 10)
    Hum = char:WaitForChild("Humanoid", 10)
    if not HRP or not Hum then task.wait(3) bindChar(char) return end
    
    Hum.MaxHealth = math.huge Hum.Health = math.huge
    for _, p in pairs(char:GetDescendants()) do if p:IsA("BasePart") then p.CanCollide = false end end
    Instance.new("ForceField", char)
end

LocalPlayer.CharacterAdded:Connect(function(c) task.wait(0.5) bindChar(c) end)
if LocalPlayer.Character then bindChar(LocalPlayer.Character) end

-- ë ˆë²¨
local function getLevel()
    local ls = LocalPlayer:WaitForChild("leaderstats", 8)
    if not ls then print("[DEBUG] leaderstats nil") return 0 end
    local lvl = ls:WaitForChild("Level", 5)
    if not lvl then print("[DEBUG] Level nil") return 0 end
    return lvl.Value or 0
end

-- getQuestNum ì•ˆì „ ë²„ì „
local function getQuestNum()
    print("[DEBUG] getQuestNum í˜¸ì¶œ")
    
    local pg = LocalPlayer:WaitForChild("PlayerGui", 15)
    if not pg then print("[WARNING] PlayerGui nil") return 0 end
    
    local sg = pg:FindFirstChild("ScreenGui") or pg:FindFirstChild("MainGui") or pg:FindFirstChild("UI") or pg:FindFirstChild("Hud")
    if not sg then print("[DEBUG] ScreenGui ê³„ì—´ nil") return 0 end
    
    local q = sg:FindFirstChild("Quest") or sg:FindFirstChild("QuestFrame") or sg:FindFirstChild("Mission")
    if not q then print("[DEBUG] Quest ê°ì²´ nil") return 0 end
    
    for _, o in pairs(q:GetDescendants()) do
        if o and (o:IsA("TextLabel") or o:IsA("TextButton")) then
            local t = o.Text or ""
            if t:find("%[2%]") then 
                print("[DEBUG] [2] ë°œê²¬")
                return 2 
            end
        end
    end
    return 0
end

-- SellItem
local function trySell()
    if tick() - lastSell < 1.5 then return end
    local r = ReplicatedStorage:FindFirstChild("Remote")
    if not r then return end
    local s = r:FindFirstChild("SellItem")
    if not s then return end
    local args = {"ëŒ ê³¨ë ˜ ë¨¸ë¦¬", "10"}
    pcall(s.FireServer, s, unpack(args))
    print("[SELL] íŒë§¤ ì‹œë„")
    lastSell = tick()
end

-- íŠ¹ìˆ˜ ê³ ë¸”ë¦° ìŠ¤í‚µ
local function isSpecial(mob)
    if not mob then return false end
    local la = mob:FindFirstChild("Left Arm") or mob:FindFirstChild("LeftArm")
    if not la then return false end
    local lar = la:FindFirstChild("L Armor") or la:FindFirstChild("LArmor")
    if not lar then return false end
    local m = lar:FindFirstChild("Meshes")
    if not m then return false end
    return m:FindFirstChild("zompg forest mob_Cone") ~= nil
end

-- íƒ€ê²Ÿ ì°¾ê¸° (FindFirstChild ì•ˆì „í™”)
local function findTarget()
    local lvl = getLevel()
    local isSlime = (lvl >= 10)
    local folder = workspace:FindFirstChild("Mobs")
    if not folder then
        print("[ERROR] Mobs í´ë” ì—†ìŒ")
        return nil
    end
    
    local kids = folder:GetChildren()
    local cands = {}
    
    for _, m in ipairs(kids) do
        if m and m:IsA("Model") then
            local match = isSlime and (m.Name == "ìŠ¬ë¼ì„") or (m.Name == "ê³ ë¸”ë¦°" or m.Name:find("ê³ ë¸”ë¦°") or m.Name:lower():find("goblin"))
            if match then
                local h = m:FindFirstChild("Humanoid") or m:FindFirstChildWhichIsA("Humanoid")
                local hrp = m:FindFirstChild("HumanoidRootPart")
                if h and hrp and h.Health > 0 then
                    if not isSlime and isSpecial(m) then continue end
                    table.insert(cands, m)
                end
            end
        end
    end
    
    print("[DEBUG] í›„ë³´ ëª¹ ìˆ˜: " .. #cands .. " (ìŠ¬ë¼ì„ ëª¨ë“œ: " .. tostring(isSlime) .. " Lv" .. lvl .. ")")
    
    if #cands == 0 then return nil end
    
    table.sort(cands, function(a,b)
        local aHRP = a:FindFirstChild("HumanoidRootPart")
        local bHRP = b:FindFirstChild("HumanoidRootPart")
        if not aHRP or not bHRP then return false end
        return (HRP.Position - aHRP.Position).Magnitude < (HRP.Position - bHRP.Position).Magnitude
    end)
    
    return cands[1]
end

-- íˆíŠ¸ë°•ìŠ¤ ìë™ ì„ íƒ
local function getBestHitPart(mob)
    if not mob then return HRP end
    for _, name in ipairs({"Head", "UpperTorso", "Torso", "HumanoidRootPart", "LowerTorso"}) do
        local part = mob:FindFirstChild(name)
        if part then return part end
    end
    return mob:FindFirstChild("HumanoidRootPart") or mob
end

-- ê³µê²© (ì¿¨íƒ€ì„ 0.02ì´ˆ)
local function attack()
    local tool = Character:FindFirstChildWhichIsA("Tool")
    if not tool then
        print("[DEBUG] íˆ´ ì—†ìŒ â†’ ê°•ì œ Equip")
        for _, t in pairs(LocalPlayer.Backpack:GetChildren()) do
            if t:IsA("Tool") then
                Hum:EquipTool(t)
                task.wait(0.15)
                tool = Character:FindFirstChildWhichIsA("Tool")
                if tool then print("[DEBUG] íˆ´ ì¥ì°©: " .. tool.Name) break end
            end
        end
    end
    
    if tool then
        print("[ATTACK] ê³µê²© ì‹œì‘ - 0.02ì´ˆ")
        for i = 1, 80 do
            pcall(tool.Activate, tool)
            task.wait(0.02)
        end
    else
        print("[WARNING] íˆ´ ì—†ìŒ")
    end
    
    VirtualUser:Button1Down(Vector2.new(500, 500))
    task.wait(0.02)
    VirtualUser:Button1Up(Vector2.new(500, 500))
end

-- ë©”ì¸ ë£¨í”„ (ìˆ˜ì§ ë¨¸ë¦¬ ìœ„ ì—ë“œë¦¼ ê³ ì •)
RunService.Heartbeat:Connect(function()
    if not farming or not HRP then return end
    
    local lvl = getLevel()
    if lvl >= 15 then farming = false print("Lv15 â†’ ì¢…ë£Œ") return end
    
    local q = getQuestNum()
    if q == 2 then trySell() end
    
    if not curTarget or not curTarget.Parent or (curTarget:FindFirstChildWhichIsA("Humanoid") and curTarget.Humanoid.Health <= 0) then
        if lvl >= 10 then
            curTarget = findSlime()
        else
            curTarget = findGoblin()
        end
        switchTime = tick()
        if curTarget then print("[TARGET] " .. curTarget.Name) end
    end
    
    if not curTarget then task.wait(1) return end
    
    local head = curTarget:FindFirstChild("Head") or curTarget:FindFirstChild("HumanoidRootPart")
    if not head then
        print("[WARNING] Head/HRP nil â†’ ì¬íƒìƒ‰")
        curTarget = nil
        return
    end
    
    local off = Vector3.new(0, 2.3, -0.3) -- ë¨¸ë¦¬ ìœ„ 2.3 + ì•ìœ¼ë¡œ 0.3
    
    local baseCFrame = CFrame.new(head.Position + off, head.Position)
    local tilt = CFrame.Angles(math.rad(-60), 0, 0) -- ë” ê°•í•˜ê²Œ ì—ë“œë¦¼
    
    local finalCFrame = baseCFrame * tilt
    
    local tweenInfo = TweenInfo.new(0.1, Enum.EasingStyle.Linear)
    local goal = {CFrame = finalCFrame}
    local tween = TweenService:Create(HRP, tweenInfo, goal)
    tween:Play()
    
    pcall(function() HRP:SetNetworkOwner(LocalPlayer) end)
    HRP.Velocity = Vector3.new(0,0,0)
    
    Hum.MaxHealth = math.huge Hum.Health = math.huge
    task.spawn(attack)
end)

print("ğŸš€ ìˆ˜ì§ ë¨¸ë¦¬ ìœ„ ì—ë“œë¦¼ ê³ ì • ê³µê²© ì™„ì„± | nil ì•ˆì „ | F9 ë¡œê·¸ í™•ì¸")
